---
- name: Deploy Calculator App using Docker Compose
  hosts: local
  vars:
    tag: "{{ image_tag }}"
  tasks:

    - name: Pull nihonium/calc-frontend image
      docker_image:
        name: nihonium/calc-frontend
        tag: "{{ tag }}"
        source: pull
        state: present

    - name: Pull nihonium/calc-backend image
      docker_image:
        name: nihonium/calc-backend
        tag: "{{ tag }}"
        source: pull
        state: present

    - name: Start containers using $TAG
      shell: |
        export TAG={{ tag }}
        docker compose up -d
      args:
        chdir: "{{ ansible_env.HOME }}"